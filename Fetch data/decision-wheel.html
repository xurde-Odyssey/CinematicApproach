<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Wheel - X U R D E</title>
    <link rel="shortcut icon" href="./assets/images/logo.ico" type="image/x-icon">

    <!-- CSS links -->
    <link rel="stylesheet" href="./assets/css/style.css">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Confetti for celebration -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* Modernized styles for the wheel and pointer */
        .wheel-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1;
            max-width: 500px;
            margin: 0 auto;
            cursor: pointer;
            transition: opacity 0.3s;
            box-sizing: border-box;
        }

        #wheelCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            /* transition is handled in JS for custom easing */
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
            border: 8px solid var(--bg-secondary);
            display: block;
        }

        .center-hub {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15%;
            height: 15%;
            background-color: #1f2937;
            border-radius: 50%;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pointer-wrapper {
            position: absolute;
            top: 50%;
            right: -25px;
            /* Position on the right */
            left: auto;
            transform: translateY(-50%) rotate(90deg);
            /* Pointing Left */
            /* Pointing Left */
            width: 60px;
            height: 60px;
            z-index: 50;
            filter: drop-shadow(-2px 4px 6px rgba(0, 0, 0, 0.3));
        }

        .pointer-svg {
            fill: #3E79F0;
            /* Bright Blue pointer */
            stroke: #ffffff;
            stroke-width: 3px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        .modal-dialog {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-20);
            width: 90%;
            max-width: 500px;
            overflow: hidden;
            box-shadow: var(--shadow-3);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay:not(.hidden) .modal-dialog {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 40px 20px;
            text-align: center;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .winner-text {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1.2;
            color: var(--text-main);
            font-family: var(--ff-jakarta);
            margin-bottom: 20px;
        }

        .modal-footer {
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 12px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-primary);
        }

        /* Adjusting for mobile */
        @media (max-width: 640px) {
            #wheelCanvas {
                top: 0;
                height: 100%;
            }
        }

        .modal-overlay.hidden {
            display: none;
            opacity: 0;
            pointer-events: none;
        }



        .quote-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-3);
            border-color: var(--accent-primary);
            background: rgba(255, 255, 255, 0.85);
        }

        .quote-text {
            font-family: var(--ff-jakarta);
            font-size: 1.15rem;
            color: var(--text-main);
            font-style: italic;
            line-height: 1.7;
            position: relative;
            z-index: 10;
            font-weight: 500;
        }

        .quote-author {
            margin-top: 16px;
            font-weight: 700;
            color: var(--accent-primary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 10;
        }

        .quote-author::before {
            content: "";
            width: 24px;
            height: 2px;
            background: var(--accent-primary);
            opacity: 0.5;
        }

        .quote-decoration {
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 120px;
            color: var(--accent-primary);
            opacity: 0.03;
            transform: rotate(-15deg);
            pointer-events: none;
            z-index: 1;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#ff8c42',
                        'primary-dark': '#e67e3a',
                    }
                }
            }
        }
    </script>
</head>

<body class="light-theme">

    <main>
        <header class="header">
            <div class="header-container">
                <a href="index.html" class="logo">
                    <img src="./assets/images/logo.ico" alt="XURDE" width="30">
                    <span>PORTFOLIO<br><small>RESUME</small></span>
                </a>

                <nav class="navbar">
                    <ul class="navbar-list">
                        <li class="navbar-item">
                            <a href="index.html" class="navbar-link" data-nav-link>Home</a>
                        </li>
                        <li class="navbar-item">
                            <a href="decision-wheel.html" class="navbar-link active" data-nav-link>Decision Wheel</a>
                        </li>

                    </ul>
                </nav>
            </div>
        </header>

        <div class="main-content" style="padding: 120px 20px 60px;">
            <div id="app"
                class="w-full max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8 md:p-12 border border-[#eef2f5] relative overflow-hidden">

                <!-- Background decorative elements -->
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-orange-50 rounded-full mix-blend-multiply filter blur-3xl opacity-70 -translate-y-1/2 translate-x-1/2">
                </div>
                <div
                    class="absolute bottom-0 left-0 w-64 h-64 bg-blue-50 rounded-full mix-blend-multiply filter blur-3xl opacity-70 translate-y-1/2 -translate-x-1/2">
                </div>

                <h2 class="h2 article-title mb-4 text-center relative z-10">Decision Wheel</h2>
                <p class="text-center text-gray-500 mb-10 text-lg relative z-10">
                    Can't decide? Let the wheel choose your destiny.
                </p>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 relative z-10">
                    <!-- 1. Wheel Section -->
                    <div class="flex flex-col items-center">
                        <div class="wheel-container" id="wheelInteractiveArea">
                            <div class="center-hub">
                                <span class="text-white font-bold text-sm uppercase tracking-widest">Tap</span>
                            </div>
                            <div class="pointer-wrapper" id="winnerPointerWrapper">
                                <svg class="pointer-svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
                                    <path d="M 50,100 L 10,20 C 5,10 15,0 25,0 L 75,0 C 85,0 95,10 90,20 L 50,100 Z" />
                                </svg>
                            </div>
                            <canvas id="wheelCanvas"></canvas>
                        </div>
                        <div id="resultMessage"
                            class="mt-6 text-xl font-bold text-gray-800 h-8 text-center transition-all">
                            Tap the wheel!
                        </div>
                    </div>

                    <!-- 2. Input Section -->
                    <div class="space-y-6">
                        <label for="optionsInput" class="block text-lg font-semibold text-gray-800">
                            Your Options <span class="text-gray-400 text-sm font-normal">(One per line or separated by
                                commas)</span>
                        </label>
                        <textarea id="optionsInput" rows="8"
                            class="w-full p-4 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-orange-100 focus:border-orange-400 outline-none transition-all shadow-sm text-gray-700 font-medium resize-none"
                            oninput="updateOptionsAndDraw()"
                            placeholder="E.g.,&#10;Pizza&#10;Burger&#10;Salad&#10;Sushi"></textarea>

                        <div class="flex gap-4 controls-row">
                            <button onclick="shuffleOptions()"
                                class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-4 px-6 rounded-2xl transition-all">
                                Shuffle
                            </button>
                            <button onclick="spinWheel()"
                                class="flex-1 bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg shadow-orange-200 transition-all transform hover:-translate-y-1 active:translate-y-0">
                                Spin It!
                            </button>
                        </div>
                        <div id="error-message" class="text-red-500 text-sm h-6 text-center"></div>


                    </div>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="modal-overlay hidden">
            <div class="modal-dialog">
                <div class="modal-header">
                    <span>We have a winner!</span>
                    <button onclick="closeModal()" class="text-white hover:text-gray-200 focus:outline-none">
                        <ion-icon name="close-circle" size="large"></ion-icon>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="text-gray-500 uppercase tracking-widest text-sm font-bold mb-4">The wheel has spoken</p>
                    <div id="winnerText" class="winner-text"></div>
                    <div class="text-6xl mb-4">ðŸŽ‰</div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeModal()"
                        class="px-6 py-3 rounded-xl bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition-colors">
                        Keep it
                    </button>
                    <button id="removeButton"
                        class="px-6 py-3 rounded-xl bg-orange-100 text-orange-600 font-bold hover:bg-orange-200 transition-colors border border-orange-200">
                        Remove & Spin Again
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer Box -->
        <div id="footer-box"
            class="w-full max-w-4xl mx-auto bg-gray-50 rounded-2xl p-6 mt-12 border border-[#eef2f5] grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- Advertisement Section: Dipak Suppliers -->
            <a href="https://www.dipaksuppliers.com.np" target="_blank"
                class="flex flex-col items-center justify-center p-6 bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all group overflow-hidden relative">
                <div class="absolute top-0 left-0 w-full h-1 bg-[#00c9ff]"></div>

                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Advertisement</p>

                <div class="flex items-center gap-4 mb-2">
                    <img src="./assets/images/dipaksupplierslogo.png" alt="Dipak Suppliers"
                        class="w-14 h-14 object-contain">
                    <div class="text-left">
                        <h3 class="text-xl font-bold text-gray-800 group-hover:text-[#00c9ff] transition-colors">Dipak
                            Suppliers</h3>
                        <p class="text-sm text-gray-500">Bio Sand Filter and Agricultural goods</p>
                    </div>
                </div>

                <div
                    class="mt-4 px-4 py-2 bg-[#00c9ff]/10 text-[#00c9ff] text-sm font-semibold rounded-lg group-hover:bg-[#00c9ff]/20 transition-colors">
                    Visit Website
                </div>
            </a>

            <!-- Enhanced YouTube Section -->
            <a href="https://www.youtube.com/@xurde-Odyssey" target="_blank"
                class="flex flex-col items-center justify-center p-6 bg-gradient-to-br from-red-50 to-white rounded-2xl border border-red-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden">
                <div
                    class="absolute top-0 right-0 w-24 h-24 bg-red-100 rounded-full blur-3xl opacity-50 -translate-y-1/2 translate-x-1/2">
                </div>

                <div class="relative z-10 flex flex-col items-center">
                    <div
                        class="w-16 h-16 mb-4 bg-white rounded-full shadow-md flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                        <ion-icon name="logo-youtube" class="text-4xl text-red-600"></ion-icon>
                    </div>

                    <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-red-600 transition-colors">Watch My
                        Journey</h3>
                    <p class="text-sm text-gray-500 mb-4">Subscribe to Xurde Odyssey</p>

                    <span
                        class="inline-flex items-center gap-2 text-sm font-bold text-red-600 border-b-2 border-red-200 group-hover:border-red-600 transition-colors pb-0.5">
                        Watch Now
                        <ion-icon name="arrow-forward-outline"></ion-icon>
                    </span>
                </div>
            </a>
        </div>

        <!-- Copyright Footer -->
        <footer class="footer">
            <div class="footer-container">
                <div class="footer-left">
                    <p>Â© 2026 Xurde Designs. All rights reserved.</p>
                </div>
                <div class="footer-right">
                    <p>Designed by <a href="#" class="designer-link">Xurde</a></p>
                </div>
            </div>
        </footer>

    </main>

    <!-- Custom JS and Ionicons -->
    <script src="./assets/js/script.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script>
        // --- Global Variables ---
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const optionsInput = document.getElementById('optionsInput');
        const resultMessage = document.getElementById('resultMessage');
        const errorMessage = document.getElementById('error-message');
        const wheel = document.getElementById('wheelCanvas');
        const wheelInteractiveArea = document.getElementById('wheelInteractiveArea');

        // Modal Variables
        const resultModal = document.getElementById('resultModal');
        const winnerTextElement = document.getElementById('winnerText');

        // Tone.js Variables
        let tickSynth = null;
        let winSynth = null;
        let tickInterval = null;

        let currentOptions = [
            "10 Push Ups", "Treat Yourself", "Call a Friend", "Take a Nap", "Read 5 Pages", "Drink Water"
        ];
        let arc = 0;
        let spinTimeout;
        let isSpinning = false;
        let currentRotation = 0; // Track actual rotation

        // Vibrant "Wheel of Names" Color Palette
        const COLORS = [
            '#36AF53', // Green
            '#F7D03B', // Yellow
            '#E83F38', // Red
            '#3E79F0'  // Blue
        ];

        // --- Tone.js Audio Initialization ---
        function initializeAudio() {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }

            if (!tickSynth) {
                tickSynth = new Tone.MembraneSynth({
                    pitchDecay: 0.05,
                    octaves: 10,
                    oscillator: { type: "sine" },
                    envelope: {
                        attack: 0.001,
                        decay: 0.4,
                        sustain: 0.01,
                        release: 1.4,
                        attackCurve: "exponential"
                    }
                }).toDestination();
                tickSynth.volume.value = -15;

                winSynth = new Tone.PolySynth(Tone.Synth, {
                    volume: -5,
                    oscillator: { type: "triangle" },
                    envelope: {
                        attack: 0.05,
                        decay: 0.3,
                        sustain: 0.1,
                        release: 2
                    }
                }).toDestination();
            }
        }

        // --- Wheel Logic ---

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
        }

        function shuffleOptions() {
            if (isSpinning) return;
            if (currentOptions.length < 2) {
                errorMessage.textContent = "Need at least two options to shuffle.";
                return;
            }
            shuffle(currentOptions);
            optionsInput.value = currentOptions.join('\n');
            drawWheel();
            resultMessage.textContent = "Shuffled!";
            errorMessage.textContent = "";
        }

        function updateOptions() {
            const rawText = optionsInput.value.trim();
            if (!rawText) {
                currentOptions = [];
                drawWheel();
                return true;
            }

            // Split by newline or comma, then trim and filter
            // Split by newline or comma, then trim and filter
            const newOptions = rawText
                .split(/[\n,]+/)
                .map(opt => opt.trim())
                .filter(opt => opt.length > 0)
                .slice(0, 50); // Limit to 50 options

            if (newOptions.length === 0) {
                currentOptions = [];
                return false;
            }

            currentOptions = newOptions;
            errorMessage.textContent = "";
            return true;
        }

        function drawWheel() {
            const dpr = window.devicePixelRatio || 1;
            const radius = (canvas.width / dpr) / 2;
            const centerX = radius;
            const centerY = radius;

            ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);

            if (currentOptions.length === 0) {
                ctx.fillStyle = '#f3f4f6';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius - 5, 0, 2 * Math.PI);
                ctx.fill();
                ctx.font = 'bold 20px "Plus Jakarta Sans", sans-serif';
                ctx.fillStyle = '#9ca3af';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('Add Options', centerX, centerY + 30); // Offset for "SPIN" hub
                return;
            }

            const numOptions = currentOptions.length;
            arc = (2 * Math.PI) / numOptions;

            ctx.font = 'bold 16px "Plus Jakarta Sans", sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < numOptions; i++) {
                const angle = i * arc;
                const color = COLORS[i % COLORS.length];

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + arc);
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                // Add a faint border between segments
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw Text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arc / 2);

                // Determine text color - specific logic for design
                // Green(#36AF53), Yellow(#F7D03B), Blue(#3E79F0) -> Black Text
                // Red(#E83F38) -> White Text
                const isRed = color.toUpperCase() === '#E83F38';
                ctx.fillStyle = isRed ? '#ffffff' : '#000000';

                const text = currentOptions[i];
                // Truncate
                const maxLen = 18;
                const displayText = text.length > maxLen ? text.substring(0, maxLen) + '...' : text;

                ctx.fillText(displayText, radius - 20, 0); // Text placed at edge minus padding
                ctx.restore();
            }
        }

        function initializeWheel() {
            const container = canvas.parentElement;
            // High DPI Canvas settings
            const dpr = window.devicePixelRatio || 1;
            const size = container.offsetWidth;

            // Set actual size in memory (scaled to account for extra pixel density)
            canvas.width = size * dpr;
            canvas.height = size * dpr; // Square

            // Scale the context to ensure correct drawing operations
            ctx.scale(dpr, dpr);

            // Reset transforms/styles for the new context size
            canvas.style.width = `${size}px`;
            canvas.style.height = `${size}px`;

            if (optionsInput.value.trim() === "") {
                optionsInput.value = currentOptions.join('\n');
            } else {
                updateOptions();
            }
            drawWheel();
        }

        function closeModal() {
            resultModal.classList.add('hidden');
            resultMessage.textContent = "Tap to spin again!";
        }

        function removeWinner(winner) {
            const index = currentOptions.indexOf(winner);
            if (index > -1) {
                currentOptions.splice(index, 1);
                optionsInput.value = currentOptions.join('\n');
                closeModal();
                updateOptionsAndDraw(); // Will redraw
                resultMessage.textContent = "Removed! Spin again.";
            }
        }

        function updateOptionsAndDraw() {
            if (updateOptions()) {
                drawWheel();
                resultMessage.textContent = "Tap center to spin!";
            }
        }

        // Confetti!
        function fireConfetti() {
            const count = 200;
            const defaults = {
                origin: { y: 0.7 }
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55, });
            fire(0.2, { spread: 60, });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45, });
        }

        async function spinWheel() {
            if (isSpinning) return;
            if (currentOptions.length < 2) {
                errorMessage.textContent = "Add at least two options!";
                return;
            }

            initializeAudio();

            // Reset error
            errorMessage.textContent = "";
            isSpinning = true;
            wheelInteractiveArea.style.opacity = '0.9';
            resultMessage.textContent = "Here we go...";
            closeModal();

            const numOptions = currentOptions.length;
            const segmentAngle = 360 / numOptions;

            // Pick a winner
            const winningIndex = Math.floor(Math.random() * numOptions);
            const winner = currentOptions[winningIndex];

            // Math to land on the winner
            // The pointer is at 0 degrees (right side) in standard canvas, but we rotated the container/pointer.
            // Our drawing starts at 0 (right).

            // We want the winning segment to align with the pointer.
            // Pointer is visually at TOP (270deg or -90deg in standard circle terms if we didn't rotate context)
            // But let's simplify: 
            // We rotate the CANVAS.

            // Current Rotation of the div
            const currentDeg = currentRotation % 360;

            // Extra spins (force at least 5 full spins)
            const extraSpins = 360 * 6;

            // 2. Rotation Calculation:
            // Pointer is at 0 degrees (Right) in standard canvas coordinates?
            // Wait, standard 0 is 3 o'clock (Right).
            // Our pointer is VISUALLY at Right (0 deg).
            const POINTER_ANGLE = 0;
            const winningCenterAngle = (winningIndex * segmentAngle) + (segmentAngle / 2);
            let rotationNeeded = POINTER_ANGLE - winningCenterAngle;
            let finalRotationBase = (rotationNeeded % 360 + 360) % 360;

            // Add full spins + ensure we always spin forward (positive delta)
            let spins = Math.floor(Math.random() * 3) + 5; // 5 to 7 spins
            let totalDegrees = (spins * 360) + finalRotationBase;

            // Complication: We are already at `currentRotation`. We need to reach a value > currentRotation
            // that is congruent to `targetRotationForWinner` mod 360.

            // Current position in mod 360
            let remainder = currentRotation % 360;

            // Distance to target
            let dist = (finalRotationBase - remainder + 360) % 360;

            // Final target
            let finalTarget = currentRotation + (spins * 360) + dist;

            // Update global
            currentRotation = finalTarget;

            // Apply styles
            wheel.style.transition = 'transform 5s cubic-bezier(0.15, 0, 0, 1)'; // ease-out-quart-ish
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            // Audio Clicker
            // We can estimate the speed and play ticks
            let startTime = Date.now();
            let duration = 5000;
            let lastSegment = -1;

            // Clear any existing interval
            if (tickInterval) clearInterval(tickInterval);

            // Simple tick loop
            tickInterval = setInterval(() => {
                let now = Date.now();
                let elapsed = now - startTime;
                if (elapsed >= duration) {
                    clearInterval(tickInterval);
                    return;
                }

                // Estimate current rotation
                // (Very rough approximation for sound syncing without complex physics loop)
                // Using valid cubic-bezier(0.15, 0, 0, 1) approximation is hard.
                // Just playing randomized ticks slowing down.

                // Ideally we track the actual DOM rotation but that's expensive.
                // Let's just play ticks based on a mock ease-out function

            }, 50); // Just a placeholder, we'll rely on the visual stop mostly

            // Better Ticking:
            // Play dense ticks at start, sparse at end.
            let animateAudio = () => {
                let now = Date.now();
                let t = (now - startTime) / duration;
                if (t >= 1) return;

                // Ease out (decelerating)
                let speed = 1 - Math.pow(1 - t, 4); // Quartic ease out
                // Speed starts high (derivative is high), ends 0.
                // Actually we desire speed (ticks per sec).
                // Speed = InitialSpeed * (1-t) ? 

                // Simplest: use setTimeout recursively with increasing delay
            };

            // Simple approach: Ticks every X degrees? 
            // We know totalDegrees ~ 2000+. 
            // Let's just play a satisfying spin sound.
            // Tone.js NoiseBurst

            (function playTick(delay) {
                if (delay > 400 || !isSpinning) return;
                tickSynth.triggerAttackRelease("C2", "32n");
                setTimeout(() => playTick(delay * 1.05 + 2), delay);
            })(20);


            setTimeout(() => {
                // Done
                isSpinning = false;
                wheelInteractiveArea.style.opacity = '1';
                wheel.style.transition = 'none'; // Lock position
                // Note: We don't need to normalize rotation unless we want to keep numbers small.
                // CSS handles large rotation values fine.

                fireConfetti();
                winSynth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "0.5");

                displayResult(winner);

            }, 5000);
        }

        // Global Variables
        let lastWinner = null;

        // ... inside window.onload or similar init
        // We can just update the existing functions

        function removeWinner(winner) {
            const target = winner || lastWinner;
            if (!target) return;

            const index = currentOptions.indexOf(target);
            if (index > -1) {
                currentOptions.splice(index, 1);
                optionsInput.value = currentOptions.join('\n');
                closeModal();
                updateOptionsAndDraw();

                // Spin again automatically
                setTimeout(() => {
                    spinWheel();
                }, 500);
            }
        }

        function displayResult(winner) {
            lastWinner = winner;
            winnerTextElement.textContent = winner;
            resultModal.classList.remove('hidden');
            resultMessage.textContent = "Winner: " + winner;
        }

        // --- Initialization ---
        window.onload = () => {
            initializeWheel();
            document.getElementById('wheelInteractiveArea').addEventListener('click', spinWheel);

            // Attach Remove & Spin listener
            document.getElementById('removeButton').addEventListener('click', () => removeWinner(lastWinner));
        };

        window.onresize = initializeWheel;

        // Expose
        window.spinWheel = spinWheel;
        window.shuffleOptions = shuffleOptions;
        window.updateOptionsAndDraw = updateOptionsAndDraw;
        window.closeModal = closeModal;
        window.removeWinner = removeWinner;

    </script>
</body>

</html>